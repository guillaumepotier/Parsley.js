<!DOCTYPE html>

<html>
<head>
  <title>form.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page"><a class="source" href="../index.html"><<< back to documentation</a>
            
              
              <a class="source" href="remote.html">
                remote.js
              </a>
            
              
              <a class="source" href="parsley.html">
                parsley.js
              </a>
            
              
              <a class="source" href="abstract.html">
                abstract.js
              </a>
            
              
              <a class="source" href="defaults.html">
                defaults.js
              </a>
            
              
              <a class="source" href="factory.html">
                factory.js
              </a>
            
              
              <a class="source" href="field.html">
                field.js
              </a>
            
              
              <a class="source" href="form.html">
                form.js
              </a>
            
              
              <a class="source" href="multiple.html">
                multiple.js
              </a>
            
              
              <a class="source" href="pubsub.html">
                pubsub.js
              </a>
            
              
              <a class="source" href="ui.html">
                ui.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="validator.html">
                validator.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>form.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>define(<span class="hljs-string">'parsley/form'</span>, [
  <span class="hljs-string">'parsley/abstract'</span>,
  <span class="hljs-string">'parsley/utils'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ParsleyAbstract, ParsleyUtils</span>) </span>{
  <span class="hljs-keyword">var</span> ParsleyForm = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">element, domOptions, options</span>) </span>{
    <span class="hljs-keyword">this</span>.__class__ = <span class="hljs-string">'ParsleyForm'</span>;
    <span class="hljs-keyword">this</span>.__id__ = ParsleyUtils.generateID();

    <span class="hljs-keyword">this</span>.$element = $(element);
    <span class="hljs-keyword">this</span>.domOptions = domOptions;
    <span class="hljs-keyword">this</span>.options = options;
    <span class="hljs-keyword">this</span>.parent = <span class="hljs-built_in">window</span>.Parsley;

    <span class="hljs-keyword">this</span>.fields = [];
    <span class="hljs-keyword">this</span>.validationResult = <span class="hljs-literal">null</span>;
  };

  ParsleyForm.prototype = {
    onSubmitValidate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
      <span class="hljs-keyword">this</span>.validate(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, event);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>prevent form submission if validation fails</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ((<span class="hljs-literal">false</span> === <span class="hljs-keyword">this</span>.validationResult || !<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'submit'</span>)) &amp;&amp; event <span class="hljs-keyword">instanceof</span> $.Event) {
        event.stopImmediatePropagation();
        event.preventDefault();
      }

      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>@returns boolean</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    validate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">group, force, event</span>) </span>{
      <span class="hljs-keyword">this</span>.submitEvent = event;
      <span class="hljs-keyword">this</span>.validationResult = <span class="hljs-literal">true</span>;

      <span class="hljs-keyword">var</span> fieldValidationResult = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>fire validate event to eventually modify things before very validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'validate'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Refresh form DOM options and form’s fields that could have changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>._refreshFields();

      <span class="hljs-keyword">this</span>._withoutReactualizingFormOptions(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>loop through fields to validate them one by one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.fields.length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>do not validate a field if not the same as given validation group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (group &amp;&amp; !<span class="hljs-keyword">this</span>._isFieldInGroup(<span class="hljs-keyword">this</span>.fields[i], group))
            <span class="hljs-keyword">continue</span>;

          fieldValidationResult = <span class="hljs-keyword">this</span>.fields[i].validate(force);

          <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span> !== fieldValidationResult &amp;&amp; fieldValidationResult.length &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.validationResult)
            <span class="hljs-keyword">this</span>.validationResult = <span class="hljs-literal">false</span>;
        }
      });

      <span class="hljs-keyword">this</span>._trigger(<span class="hljs-keyword">this</span>.validationResult ? <span class="hljs-string">'success'</span> : <span class="hljs-string">'error'</span>);
      <span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'validated'</span>);

      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.validationResult;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Iterate over refreshed fields, and stop on first failure</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isValid: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">group, force</span>) </span>{
      <span class="hljs-keyword">this</span>._refreshFields();

      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._withoutReactualizingFormOptions(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.fields.length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>do not validate a field if not the same as given validation group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (group &amp;&amp; !<span class="hljs-keyword">this</span>._isFieldInGroup(<span class="hljs-keyword">this</span>.fields[i], group))
            <span class="hljs-keyword">continue</span>;

          <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span> === <span class="hljs-keyword">this</span>.fields[i].isValid(force))
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      });
    },

    _isFieldInGroup: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">field, group</span>) </span>{
      <span class="hljs-keyword">if</span>($.isArray(field.options.group))
        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span> !== $.inArray(group, field.options.group);
      <span class="hljs-keyword">return</span> field.options.group === group;
    },

    _refreshFields: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actualizeOptions()._bindFields();
    },

    _bindFields: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
        oldFields = <span class="hljs-keyword">this</span>.fields;

      <span class="hljs-keyword">this</span>.fields = [];
      <span class="hljs-keyword">this</span>.fieldsMappedById = {};

      <span class="hljs-keyword">this</span>._withoutReactualizingFormOptions(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">this</span>.$element
        .find(<span class="hljs-keyword">this</span>.options.inputs)
        .not(<span class="hljs-keyword">this</span>.options.excluded)
        .each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">var</span> fieldInstance = <span class="hljs-keyword">new</span> Parsley.Factory(<span class="hljs-keyword">this</span>, {}, self);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Only add valid and not excluded <code>ParsleyField</code> and <code>ParsleyFieldMultiple</code> children</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> ((<span class="hljs-string">'ParsleyField'</span> === fieldInstance.__class__ || <span class="hljs-string">'ParsleyFieldMultiple'</span> === fieldInstance.__class__) &amp;&amp; (<span class="hljs-literal">true</span> !== fieldInstance.options.excluded))
            <span class="hljs-keyword">if</span> (<span class="hljs-string">'undefined'</span> === <span class="hljs-keyword">typeof</span> self.fieldsMappedById[fieldInstance.__class__ + <span class="hljs-string">'-'</span> + fieldInstance.__id__]) {
              self.fieldsMappedById[fieldInstance.__class__ + <span class="hljs-string">'-'</span> + fieldInstance.__id__] = fieldInstance;
              self.fields.push(fieldInstance);
            }
        });

        $(oldFields).not(self.fields).each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'reset'</span>);
        });
      });
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Internal only.
Looping on a form’s fields to do validation or similar
will trigger reactualizing options on all of them, which
in turn will reactualize the form’s options.
To avoid calling actualizeOptions so many times on the form
for nothing, _withoutReactualizingFormOptions temporarily disables
the method actualizeOptions on this form while <code>fn</code> is called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _withoutReactualizingFormOptions: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
      <span class="hljs-keyword">var</span> oldActualizeOptions = <span class="hljs-keyword">this</span>.actualizeOptions;
      <span class="hljs-keyword">this</span>.actualizeOptions = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> };
      <span class="hljs-keyword">var</span> result = fn.call(<span class="hljs-keyword">this</span>); <span class="hljs-comment">// Keep the current `this`.</span>
      <span class="hljs-keyword">this</span>.actualizeOptions = oldActualizeOptions;
      <span class="hljs-keyword">return</span> result;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Internal only.
Shortcut to trigger an event
Returns true iff event is not interrupted and default not prevented.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _trigger: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">eventName</span>) </span>{
      eventName = <span class="hljs-string">'form:'</span> + eventName;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.trigger.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    }

  };

  <span class="hljs-keyword">return</span> ParsleyForm;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
<script type="text/javascript">var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-37229467-1"]);_gaq.push(["_trackPageview"]);(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();</script></body>
</html>
